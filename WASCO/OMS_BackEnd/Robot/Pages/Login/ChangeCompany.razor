@page "/Login/ChangeCompany"
@*
    @using Robot.Data.DA
    @using Robot.Data.GADB.TT
    @using System.Threading;
    @using System.Threading.Tasks;
    @using Microsoft.EntityFrameworkCore
    @using Robot.Data.DA.Login
    @using Robot.Data.DA.Master
*@
@*
    @inject LogInService login
    @inject IJSRuntime JsRuntime
    @inject NavigationManager nav
    @inject Blazored.LocalStorage.ILocalStorageService localStorage

*@
<style>
    .fix-center {
        position: fixed;
        top: 50%;
        left: 50%;
        -webkit-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
    }
</style>

<SpinLoader IsLoading="isLoading">
    <LoadingTemplate>
        <div class="col-12 text-center" style="background-color: transparent; height: 100%; vertical-align: middle;">
            <br /><br />
            <div class="row pt-2">
                <div class="col-10 mx-auto">
                    <label style="color:orange; font-size:x-large;">... รอโหลดสักครู่ ...</label><br /><br /><br /><br />
                    <CircleFade Color="orange" Size="100px" Center="true" />
                    @*<Circle Color="orange" Size="165px" />*@
                </div>
            </div>
        </div>
    </LoadingTemplate>
    <ContentTemplate>



        <div class="row pb-1 pt-5">
            <div class="col-md-6 col-sm-12 col-12 pt-2 pb-2 text-center mx-auto">
                <div class="card text-white bg-white mb-3">
                    <div class="card-header"><h2 style="color:black">เปลี่ยนสาขา</h2></div>
                    <div class="card-body">
                        @if (listcom.Count == 0) {
                            <div class="row ">
                                <div class="col-12 text-center">
                                    <h2>ไม่มีสาขา</h2>
                                </div>
                            </div>

                        } else {
                            foreach (var r in listcom) {
                                <a class="btn p-0 w-100" @onclick="@(async () => await SelecCom(r.CompanyID))">
                                    <div class="row ">
                                        <div class="col-2">
                                            <img class="me-3" src="/assets/img/menulogo.png" alt="" width="48" height="48">
                                        </div>
                                        <div class="col-10 text-start">
                                            <p class="card-text" style="color:black">@r.Name</p>
                                        </div>
                                    </div>
                                    <hr />
                                </a>
                            }
                        }
                    </div>
                </div>

            </div>
        </div>



    </ContentTemplate>
</SpinLoader>

@code {

    bool isLoading = true;
    string companyname = "";
    List<CompanyService.CompanyInfoList> listcom = new List<CompanyService.CompanyInfoList>();

    protected override async Task OnInitializedAsync() {
        if (login.LoginInfo == null) {
            login.LoginInfo = await Task.Run(login.GetLoginSessionLog);
            if (login.LoginInfo == null) {
                nav.NavigateTo("Login", true);
            } else {
                await Task.Run(LoadData);
            }
        } else {
            await Task.Run(LoadData);
        }
    }

    protected override void OnInitialized() {
        //    isLoading = true;
        //LoadData();
    }

    void LoadData() {
        listcom = CompanyService.ListCompanyInfoUIC(login.LoginInfo, "BRANCH", false);
        isLoading = false;
        InvokeAsync(StateHasChanged);
    }


    async Task SelecCom(string com) {
        var comInfo = CompanyService.GetComInfoByComID(com);
        login.LoginInfo.CurrentCompany = comInfo;
        await Task.Run(() => login.SetLoginSessionLog(login.LoginInfo));

        var url =   login. GetFirstBoardUrl();
        nav.NavigateTo(url);
        //if (login.LoginInfo?.UserInBoard.Count == 0) {
        //    nav.NavigateTo("Dashboard/PersonBoard", false);
        //} else {
        //    var get_first_board = login.LoginInfo?.UserInBoard.FirstOrDefault();
        //    nav.NavigateTo(get_first_board.BoardUrl, false);
        //}
    }



 


}
