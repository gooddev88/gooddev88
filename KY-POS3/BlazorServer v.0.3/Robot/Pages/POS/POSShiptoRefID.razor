@page "/POS/POSShiptoRefID/{pagecomefrom}"

@using Robot.Data.DA.POSSY
@using Robot.Data.DA
@using Robot.Data.GADB.TT
@using System.Threading;
@using System.Threading.Tasks;
@using Microsoft.EntityFrameworkCore
@using static Robot.Data.DA.POSSY.ShipToService
@using Blazored.LocalStorage

@inject POSService posService
@inject LogInService login
@inject IJSRuntime JsRuntime
@inject NavigationManager nav
@inject TableInfoService tableService
@inject ILocalStorageService localStorage
@inject PageHistoryState pageHistory

<div class="row pt-2 px-2">
    <div class="col-12">
        <div class="card" style="border-radius: 10px;">
            <div class="card-body p-3">
                <div class="row">
                    <div class="col-md-1 col-sm-2 col-2 text-left">
                        <a ID="btnback" class="" @onclick="@Back">
                            <img src="/SALE/assets/img/back.png" style="width:2rem;" />
                        </a>&nbsp;
                    </div>
                    <div class="col-md-11 col-sm-10 col-10 pl-0 text-left">
                        <strong style="font-size:2rem; color:crimson;">เลขอ้างอิงการสั่ง</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row  ">
    <div class="col-md-5  mx-auto text-center ">
            <div class="row">
            <div class="col-md-12">
                <h4>ระบุเลขอ้างอิงการสั่ง</h4>
            </div>
        </div>
        <div class="row  pt-2">
            <div class="col-md-12  text-center">
                <TelerikTextBox @bind-Value="@txtshiptoRefID"
                                Size="ThemeConstants.DropDownList.Size.Small" />

                    
            </div>
        </div>
        <div class="row pt-2">
            <div class="col-md-12  text-right">
                <a ID="btnAddTables" runat="server"
                   class="btn btn-info px-3"
                   @onclick="@AddTables">
                    <label class="text-white">ตกลง</label>
                </a>
            </div>
        </div>

    </div>
</div>


@code {
    bool isLoading = true;
    [Parameter]
    public string pagecomefrom { get; set; } = "";
    public string txtshiptoRefID { get; set; } = "";


    protected override async Task OnInitializedAsync() {
        if (login.LoginInfo == null) {
            login.LoginInfo = await Task.Run(login.GetLoginSessionLog);
            if (login.LoginInfo == null) {
                nav.NavigateTo("Login", true);
            }
        }
        await Task.Run(LoadData);
        isLoading = false;
    }
    void LoadData() {
        var rcom = login.LoginInfo.CurrentRootCompany.CompanyID;
        var com = login.LoginInfo.CurrentCompany.CompanyID;
        txtshiptoRefID = posService.DocSet.Head.TableName;
    }

    async void AddTables() {
        posService.DocSet.Head.TableID = "T-001";
        posService.DocSet.Head.TableName = txtshiptoRefID;
        nav.NavigateTo($"POS/POSSaleDetail/{pagecomefrom}", false);
        await InvokeAsync(StateHasChanged);
    }
    async void Back() {
        await Task.Run(() => login.SetLoginSessionLog(login.LoginInfo));

        var url = pageHistory.GetGoBackPage();
        nav.NavigateTo(url);
        await InvokeAsync(StateHasChanged);

    }

}



